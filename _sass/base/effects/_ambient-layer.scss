// ============================================================================
// SENTIENT AMBIENT LAYER - The Atmospheric Foundation
// ============================================================================
// Creates a persistent, hardware-accelerated ambient rhythm across all pages
// This shared "consciousness pulse" unifies the subdomain ecosystem
// ============================================================================

// ----------------------------------------
// AMBIENT RESET - Canvas Preparation
// ----------------------------------------
html {
  // Ensure consistent baseline across all pages
  min-height: 100vh;
  // Smooth scroll only for anchor links, not general page scroll
  // This prevents conflicts with header scroll animations
  scroll-behavior: auto;
  
  // Apply smooth scroll only when specifically requested
  &.smooth-scroll {
    scroll-behavior: smooth;
  }
}

body {
  // Establish the atmospheric canvas
  position: relative;
  min-height: 100vh;
  overflow-x: hidden; // Prevent horizontal scroll from ambient effects
  overflow-y: auto;   // Explicitly enable vertical scrolling (fix mobile portrait scroll)
  
  // Enable smooth touch scrolling on iOS/mobile devices
  -webkit-overflow-scrolling: touch;
  touch-action: pan-y pan-x;  // Allow vertical and horizontal panning
  
  // Font smoothing for better text rendering
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  
  // Establish stacking context for ambient layers
  isolation: isolate;
}

// ----------------------------------------
// ATMOSPHERIC LAYER - Sentient Background
// ----------------------------------------
// Fixed pseudo-elements create persistent ambient consciousness
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -2;
  pointer-events: none;
  
  // Base atmospheric gradient - solid black background
  background: 
    radial-gradient(
      circle at 20% 30%, 
      oklch(0.20 0.08 290 / 0.15) 0%, 
      transparent 50%
    ),
    radial-gradient(
      circle at 80% 70%, 
      oklch(0.18 0.06 210 / 0.12) 0%, 
      transparent 50%
    ),
    $surface-dark;  // Solid black background
  
  // Hardware acceleration
  will-change: transform;
  transform: translate3d(0, 0, 0);
  
  // Subtle low-frequency breathing animation
  animation: ambient-breathe 12s ease-in-out infinite;
}

body::after {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
  pointer-events: none;
  
  // Overlay neural network pattern
  background-image: 
    radial-gradient(circle at 1px 1px, oklch(0.85 0.16 85 / 0.03) 1px, transparent 0);
  background-size: 40px 40px;
  
  // Hardware acceleration
  will-change: transform, opacity;
  transform: translate3d(0, 0, 0);
  
  // Counter-phase pulse for depth
  animation: ambient-pulse 8s ease-in-out infinite;
  opacity: 0.4;
}

// ----------------------------------------
// AMBIENT ANIMATIONS - The Shared Rhythm
// ----------------------------------------

// Low-frequency breathing - creates shared consciousness rhythm
@keyframes ambient-breathe {
  0%, 100% {
    transform: translate3d(0, 0, 0) scale(1);
    opacity: 1;
  }
  50% {
    transform: translate3d(0, 2px, 0) scale(1.01);
    opacity: 0.95;
  }
}

// Neural pulse - counter-rhythm for depth perception
@keyframes ambient-pulse {
  0%, 100% {
    transform: translate3d(0, 0, 0);
    opacity: 0.4;
  }
  50% {
    transform: translate3d(-1px, -1px, 0);
    opacity: 0.5;
  }
}

// ----------------------------------------
// AMBIENT INTERACTION STATES
// ----------------------------------------
// Optional: Respond to user interaction states

body.user-idle::before {
  // Slower breathing when user is idle
  animation-duration: 18s;
}

body.user-active::before {
  // Faster breathing during active interaction
  animation-duration: 8s;
}

// ----------------------------------------
// ACCESSIBILITY OVERRIDES
// ----------------------------------------
// Respect user preferences for reduced motion
@media (prefers-reduced-motion: reduce) {
  body::before,
  body::after {
    animation: none;
    transform: none;
    will-change: auto;
  }
  
  html {
    scroll-behavior: auto;
  }
}

// ----------------------------------------
// HIGH CONTRAST MODE
// ----------------------------------------
// Simplify ambient layer for high contrast
@media (prefers-contrast: high) {
  body::before {
    background: $surface-dark;  // Solid black background for high contrast
  }
  
  body::after {
    display: none;
  }
}

// ----------------------------------------
// PRINT OPTIMIZATION
// ----------------------------------------
// Remove ambient effects for print
@media print {
  body::before,
  body::after {
    display: none;
  }
  
  body {
    overflow-x: visible;
    min-height: auto;
  }
}
