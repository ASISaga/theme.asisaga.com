/**
 * SPATIAL ENGINE - Environment Layout Logic
 * --------------------------------------------------------------------------
 * Defines the organizational laws of the digital dimension.
 * 
 * This is part of the Engine Layer where raw CSS properties are allowed.
 * All values MUST use CSS custom properties defined in the design token system.
 */

// ============================================================================
// SPATIAL ENGINE - Environment Layout Logic
// ============================================================================
@mixin _theme-engine-environment($logic) {
  display: grid;
  contain: layout style;
  isolation: isolate;
  
  @if $logic == 'distributed' {
    // Autonomous entities in non-linear grid (Bento) - responsive by default
    container-type: inline-size;
    justify-content: center;  // Center tracks to prevent right-side drift
    
    // Mobile: single column for clarity
    @media (max-width: 767px) {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }
    
    // Tablet: 2 columns
    @media (min-width: 768px) and (max-width: 1023px) {
      grid-template-columns: repeat(2, 1fr);
      gap: 1.75rem;
    }
    
    // Desktop: auto-fit with min/max (responsive to ultra-small screens)
    @media (min-width: 1024px) {
      grid-template-columns: repeat(auto-fit, minmax(min(300px, 100%), 1fr));
      gap: 2rem;
    }
    
    // Ultrawide: cap at 4 columns for readability
    @media (min-width: 1920px) {
      grid-template-columns: repeat(4, 1fr);
      max-width: 1600px;
      margin-inline: auto;  // Explicit inline centering for consistency
    }
  } 
  @else if $logic == 'focused' {
    // Singular narrative thread for deep reading
    grid-template-columns: 1fr;
    max-width: var(--width-reading, 70ch);
    margin-inline: auto;
    gap: var(--space-narrative, clamp(1.5rem, 2.5vw, 2rem));
    padding-inline: var(--padding-inline, clamp(1rem, 3vw, 2rem));
  }
  @else if $logic == 'associative' {
    // Network where connections outweigh nodes
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-network, clamp(1rem, 2vw, 1.5rem));
    justify-content: center;
    align-items: flex-start;
  }
  @else if $logic == 'chronological' {
    // Time-linear stream of sequential events
    grid-template-columns: 1fr;
    gap: var(--space-timeline, clamp(1rem, 2vw, 1.5rem));
    position: relative;
  }
  @else if $logic == 'manifest' {
    // High-density dashboard for system oversight - responsive grid
    gap: var(--space-tight, clamp(0.75rem, 1.5vw, 1rem));
    container-type: inline-size;
    
    // Mobile: simplified 2-column layout
    @media (max-width: 767px) {
      grid-template-columns: repeat(2, 1fr);
    }
    
    // Tablet: 6-column grid
    @media (min-width: 768px) and (max-width: 1023px) {
      grid-template-columns: repeat(6, 1fr);
    }
    
    // Desktop: full 12-column grid
    @media (min-width: 1024px) {
      grid-template-columns: repeat(12, 1fr);
    }
  }
  @else if $logic == 'navigation-primary' {
    // Main site navigation - horizontal desktop â†’ mobile drawer
    // Desktop: horizontal header
    @media (min-width: 768px) {
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 1000;
      gap: var(--space-nav, clamp(1rem, 2vw, 2rem));
      padding: var(--padding-nav, clamp(1rem, 2vw, 1.5rem));
    }
    
    // Mobile: off-canvas drawer pattern
    @media (max-width: 767px) {
      position: fixed;
      top: 0;
      left: -100%;
      width: 80%;
      max-width: 320px;
      height: 100vh;
      padding: 2rem 1.5rem;
      transition: left 0.3s ease-in-out;
      z-index: 1001;
      overflow-y: auto;
      
      // Apply glassmorphism to mobile nav
      background: var(--glass-heavy, oklch(0.20 0.04 245 / 0.95));
      backdrop-filter: blur(20px);
      box-shadow: 2px 0 20px oklch(0.10 0.03 250 / 0.3);
      
      // Open state (controlled by JavaScript)
      &.nav-open {
        left: 0;
      }
      
      // Navigation items stack vertically on mobile
      > * {
        display: block;
        margin-bottom: 1rem;
      }
    }
  }
  @else if $logic == 'navigation-secondary' {
    // Contextual navigation - breadcrumbs, footer nav
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-nav-secondary, clamp(0.5rem, 1vw, 1rem));
    align-items: center;
    
    // Desktop: full visibility
    @media (min-width: 768px) {
      justify-content: flex-start;
      
      > * {
        display: inline-flex;
      }
    }
    
    // Tablet: condensed with potential overflow
    @media (min-width: 768px) and (max-width: 1023px) {
      font-size: 0.9rem;
    }
    
    // Mobile: minimal or hidden (controlled by subdomain)
    @media (max-width: 767px) {
      font-size: 0.85rem;
      justify-content: center;
      
      // Allow subdomains to hide non-essential items
      .secondary-only {
        display: none;
      }
    }
  }
  @else if $logic == 'interaction-form' {
    // Form layout optimized for data entry
    display: grid;
    gap: 1.5rem;
    justify-content: center;  // Center form fields to prevent drift
    
    // Mobile: force single column for clarity
    @media (max-width: 767px) {
      grid-template-columns: 1fr;
      gap: 1.25rem;
    }
    
    // Tablet: 2-column where appropriate (responsive to ultra-small screens)
    @media (min-width: 768px) and (max-width: 1023px) {
      grid-template-columns: repeat(auto-fit, minmax(min(250px, 100%), 1fr));
      gap: 1.5rem 1.25rem;
    }
    
    // Desktop: allow multi-column with intelligent fitting (responsive to ultra-small screens)
    @media (min-width: 1024px) {
      grid-template-columns: repeat(auto-fit, minmax(min(300px, 100%), 1fr));
      gap: 2rem 1.5rem;
    }
    
    // Form-specific child elements
    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }
    
    // Ensure full-width elements span all columns
    .form-full-width {
      grid-column: 1 / -1;
    }
  }
  @else if $logic == 'navigation-tabs' {
    // Horizontal tab navigation for content switching
    display: flex;
    gap: var(--space-tabs, clamp(0.5rem, 1vw, 1rem));
    border-bottom: 2px solid var(--border-subtle, oklch(0.30 0.04 250 / 0.3));
    
    // Mobile: scrollable tabs if overflow
    @media (max-width: 767px) {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      
      &::-webkit-scrollbar {
        display: none;
      }
      
      // Prevent wrapping on mobile
      flex-wrap: nowrap;
    }
    
    // Tablet and desktop: wrap if needed
    @media (min-width: 768px) {
      flex-wrap: wrap;
    }
  }
  @else if $logic == 'navigation-sidebar' {
    // Vertical sidebar navigation layout
    display: flex;
    flex-direction: column;
    gap: var(--space-sidebar, clamp(0.5rem, 1vw, 0.75rem));
    
    // Mobile: can be hidden or converted to horizontal
    @media (max-width: 767px) {
      // Allow subdomains to convert to horizontal or hide
      &.mobile-horizontal {
        flex-direction: row;
        flex-wrap: wrap;
      }
      
      &.mobile-hidden {
        display: none;
      }
    }
    
    // Tablet and desktop: consistent vertical layout
    @media (min-width: 768px) {
      width: var(--sidebar-width, clamp(200px, 25vw, 280px));
      position: sticky;
      top: var(--sidebar-offset, 80px);
      align-self: flex-start;
      max-height: calc(100vh - var(--sidebar-offset, 80px) - 2rem);
      overflow-y: auto;
    }
  }
  @else if $logic == 'navigation-footer' {
    // Multi-column footer navigation layout
    display: grid;
    gap: var(--space-footer, clamp(2rem, 3vw, 3rem));
    justify-content: center;  // Center footer columns to prevent drift
    
    // Mobile: single column for clarity
    @media (max-width: 767px) {
      grid-template-columns: 1fr;
      gap: 2rem;
    }
    
    // Tablet: 2 columns
    @media (min-width: 768px) and (max-width: 1023px) {
      grid-template-columns: repeat(2, 1fr);
      gap: 2.5rem 2rem;
    }
    
    // Desktop: 3-4 columns based on content (responsive to ultra-small screens)
    @media (min-width: 1024px) {
      grid-template-columns: repeat(auto-fit, minmax(min(200px, 100%), 1fr));
      gap: 3rem 2rem;
    }
  }
  @else if $logic == 'navigation-breadcrumb' {
    // Breadcrumb trail navigation layout
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: var(--space-breadcrumb, 0.5rem);
    
    // Mobile: allow truncation or scrolling
    @media (max-width: 767px) {
      font-size: 0.875rem;
      
      // Option to make scrollable on mobile
      &.mobile-scroll {
        flex-wrap: nowrap;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
        
        &::-webkit-scrollbar {
          display: none;
        }
      }
    }
  }
  @else if $logic == 'navigation-pagination' {
    // Pagination controls layout
    display: flex;
    justify-content: center;
    align-items: center;
    gap: var(--space-pagination, clamp(0.5rem, 1vw, 0.75rem));
    flex-wrap: wrap;
    
    // Mobile: show fewer page numbers, prioritize prev/next
    @media (max-width: 767px) {
      gap: 0.5rem;
      
      // Allow hiding non-essential page numbers
      .page-number-optional {
        display: none;
      }
    }
    
    // Tablet and desktop: show more page numbers
    @media (min-width: 768px) {
      gap: 0.75rem;
    }
  }
  @else if $logic == 'navigation-accordion' {
    // Accordion/collapsible navigation layout
    display: flex;
    flex-direction: column;
    gap: var(--space-accordion, clamp(0.5rem, 1vw, 1rem));
    
    // Consistent across all viewport sizes
    width: 100%;
  }
  @else if $logic == 'community-feed' {
    // Activity feed/timeline layout for community updates
    display: flex;
    flex-direction: column;
    gap: var(--space-feed, clamp(1rem, 2vw, 1.5rem));
    
    // Mobile: single column with tighter spacing
    @media (max-width: 767px) {
      gap: 1rem;
    }
    
    // Tablet and desktop: maintain spacing
    @media (min-width: 768px) {
      gap: 1.5rem;
    }
    
    // Container query support for responsive feed items
    container-type: inline-size;
  }
  @else if $logic == 'comment-thread' {
    // Nested comment discussion layout
    display: flex;
    flex-direction: column;
    gap: var(--space-comments, clamp(0.75rem, 1.5vw, 1rem));
    
    // Nested comment indentation
    .comment-reply,
    .comment-nested {
      margin-left: var(--comment-indent, clamp(1.5rem, 3vw, 2.5rem));
      padding-left: var(--comment-border, 1rem);
      border-left: 2px solid var(--border-subtle, oklch(0.30 0.04 250 / 0.3));
    }
    
    // Mobile: reduce indentation to save space
    @media (max-width: 767px) {
      --comment-indent: 1rem;
      --comment-border: 0.75rem;
    }
    
    // Desktop: show deeper nesting levels
    @media (min-width: 1024px) {
      --comment-indent: 2.5rem;
      --comment-border: 1rem;
    }
    
    // Limit nesting depth visually
    .comment-nested .comment-nested .comment-nested {
      margin-left: 0;
      padding-left: var(--comment-border, 1rem);
    }
  }
  @else if $logic == 'notification-center' {
    // Notification panel layout
    display: flex;
    flex-direction: column;
    max-height: var(--notification-max-height, 400px);
    overflow-y: auto;
    gap: var(--space-notifications, 0.5rem);
    
    // Mobile: full height available
    @media (max-width: 767px) {
      max-height: calc(100vh - 200px);
    }
    
    // Tablet: moderate height
    @media (min-width: 768px) and (max-width: 1023px) {
      max-height: 500px;
    }
    
    // Desktop: fixed height with scroll
    @media (min-width: 1024px) {
      max-height: 600px;
    }
    
    // Notification grouping
    .notification-group {
      padding: 0.75rem 0;
      border-bottom: 1px solid var(--border-subtle, oklch(0.30 0.04 250 / 0.3));
      
      &:last-child {
        border-bottom: none;
      }
    }
    
    .notification-group-header {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-secondary, oklch(0.70 0.02 220));
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.5rem;
      padding: 0 0.5rem;
    }
  }
  @else if $logic == 'user-grid' {
    // User/member grid display layout
    display: grid;
    gap: var(--space-user-grid, clamp(1rem, 2vw, 1.5rem));
    container-type: inline-size;
    justify-content: center;  // Center user cards to prevent drift
    
    // Mobile: single column for user cards
    @media (max-width: 767px) {
      grid-template-columns: 1fr;
      gap: 1rem;
    }
    
    // Tablet: 2 columns
    @media (min-width: 768px) and (max-width: 1023px) {
      grid-template-columns: repeat(2, 1fr);
      gap: 1.25rem;
    }
    
    // Desktop: 3-4 columns based on container size (responsive to ultra-small screens)
    @media (min-width: 1024px) {
      grid-template-columns: repeat(auto-fit, minmax(min(240px, 100%), 1fr));
      gap: 1.5rem;
    }
    
    // Ultrawide: cap at 4 columns
    @media (min-width: 1920px) {
      grid-template-columns: repeat(4, 1fr);
    }
  }
}
